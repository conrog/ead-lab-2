<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title></title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- <link rel="stylesheet" href=""> -->
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <h1>Country Website</h1>
    <button id="get-countries" onclick="">Get Countries</button>
    <!-- <script src="/app.js" async defer></script> -->
  </body>

  <script>
    let countryTableData = {}; //Object used to store fetched data

    // Function that merges json data from server into a single object
    // whose key is the name of a country and value is an array of data
    // asssoicated with that country
    // Parameters:
    // - array is the array of fetched json data to be iterated over
    // - keyName is the name of the key of the object
    // - valueName is the name of the object property
    function processFetchedData(array, keyName, valueName) {
      for (let i = 0; i < array.length; i++) {
        let key = array[i][keyName];
        let value = array[i][valueName];
        if (countryTableData.hasOwnProperty(key)) {
          countryTableData[key].push(value);
        } else {
          countryTableData[key] = [value];
        }
      }
    }

    async function getCountryData() {
      try {
        //Asynchronously request all json files from the server
        const [capitals, contients, costlines, currencies, domains, flags] =
          await Promise.all([
            $.ajax("/country-by-capital-city.json"),
            $.ajax("/country-by-continent.json"),
            $.ajax("/country-by-costline.json"),
            $.ajax("/country-by-currency-name.json"),
            $.ajax("/country-by-domain-tld.json"),
            $.ajax("/country-by-flag.json"),
          ]);

        //Merge all fetched data into single object
        processFetchedData(capitals, "country", "city");
        processFetchedData(contients, "country", "continent");
        processFetchedData(costlines, "country", "costline");
        processFetchedData(currencies, "country", "currency_name");
        processFetchedData(domains, "country", "tld");
        processFetchedData(flags, "country", "flag_base64");

        console.log(countryTableData);
      } catch (error) {
        console.log(error);
      }
    }

    $("#get-countries").on("click", () => {
      getCountryData();
    });
  </script>
</html>
